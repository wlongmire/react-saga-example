patient_web:
  build:
    context: .
    dockerfile: Dockerfile
    args:
      - CI_BRANCH=${CI_BRANCH}
  volumes:
    - .:/usr/src/app
  environment:
    - REACT_APP_ENV_NAME=${CI_BRANCH}
    - CI_BRANCH
  cached: false

patient_web_test:
  build: .
  dockerfile: Dockerfile.development
  volumes:
    - .:/usr/src/app
patient_web_e2e_test:
  build:
    dockerfile: Dockerfile.test
  volumes_from:
    - patient_web
  links:
    - patient_web_test
  cached: true

task_definition:
  build:
    dockerfile: Dockerfile.build
  volumes:
    - ./tmp:/data

ecs_cheap:
  image: codeship/aws-deployment
  encrypted_env_file: aws-deployment.env.encrypted
  environment:
    - AWS_DEFAULT_REGION=us-east-1
  volumes_from:
    - task_definition

ecs_guitars:
  image: codeship/aws-deployment
  encrypted_env_file: aws-deployment.env.encrypted
  environment:
    - AWS_DEFAULT_REGION=us-east-2
  volumes_from:
    - task_definition

ecs_co:
  image: codeship/aws-deployment
  encrypted_env_file: aws-deployment.env.prod.encrypted
  environment:
    - AWS_DEFAULT_REGION=us-east-1
  volumes_from:
    - task_definition
